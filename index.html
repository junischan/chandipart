<!DOCTYPE html><html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Cat√°logo de repuestos automotrices Otto Repuestos (pr√°ctica)." />
  <meta name="keywords" content="repuestos, automotriz, Otto Repuestos, pr√°ctica, cat√°logo" />
  <title>Otto Repuestos - Cat√°logo</title>
  <base href="./" />
  <style>
    :root {
      --primary-bg: #0b0f19;
      --card-bg: #141a2a;
      --text-color: #e6e8ee;
      --accent-color: #25d366;
      --border-color: #2a3441;
      --shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
      --font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif;
    }
    body { margin: 0; background: var(--primary-bg); color: var(--text-color); font-family: var(--font-family); }
    @media (prefers-color-scheme: light) {
      :root { --primary-bg:#f5f5f5; --card-bg:#fff; --text-color:#333; --border-color:#ccc; }
    }
    .header { padding:20px; background:var(--card-bg); box-shadow:var(--shadow); position:sticky; top:0; z-index:50; }
    h1 { text-align:center; font-size:2em; margin:0 0 16px 0; }
    .search-container { max-width:500px; margin:0 auto; position:relative; }
    .search-input { width:100%; padding:12px 50px 12px 20px; border:2px solid var(--border-color); border-radius:25px; background:var(--primary-bg); color:var(--text-color); font-size:16px; box-sizing:border-box; }
    .search-input:focus { outline:none; border-color:var(--accent-color); }
    .search-clear { position:absolute; right:15px; top:50%; transform:translateY(-50%); background:none; border:none; color:#a7b0c3; cursor:pointer; font-size:18px; display:none; }
    .search-clear:hover{ color:var(--text-color); }
    .controls { display:flex; justify-content:space-between; align-items:center; padding:12px 15px; flex-wrap:wrap; gap:10px; }
    .filter-buttons { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }
    .filter-btn { padding:8px 16px; border:1px solid var(--border-color); border-radius:20px; background:var(--card-bg); color:var(--text-color); cursor:pointer; transition:.3s; font-size:12px; }
    .filter-btn:hover,.filter-btn.active{ background:var(--accent-color); border-color:var(--accent-color); color:#000; }
    .stats { font-size:12px; color:#a7b0c3; }
    .grid{ column-count:2; column-gap:15px; padding:15px; }
    .card{ background:var(--card-bg); border-radius:10px; box-shadow:var(--shadow); overflow:hidden; margin-bottom:15px; display:inline-block; width:100%; break-inside:avoid; cursor:pointer; transition:transform .2s, box-shadow .2s; position:relative; }
    .card:hover{ transform:translateY(-2px); box-shadow:0 5px 20px rgba(0,0,0,.4); }
    .card img{ width:100%; height:auto; object-fit:cover; display:block; background:#0f1529; }
    .info{ padding:10px; font-size:13px; }
    .info .codigo{ font-weight:700; font-size:14px; }
    .info .desc{ color:#a7b0c3; font-size:11px; margin-top:5px; margin-bottom:10px; }
    .info .precio{ font-weight:700; color:var(--accent-color); font-size:15px; }
    .card-actions{ padding:0 10px 10px; display:flex; gap:8px; }
    .btn{ flex:1; padding:8px; border:none; border-radius:5px; cursor:pointer; font-size:11px; font-weight:600; transition:.2s; }
    .btn-whatsapp{ background:var(--accent-color); color:#000; }
    .btn-whatsapp:hover{ background:#1ea952; }
    .btn-share{ background:var(--border-color); color:var(--text-color); }
    .btn-share:hover{ background:#3a4551; }
    .cart-float{ position:fixed; bottom:20px; right:20px; background:var(--accent-color); color:#000; border-radius:50%; width:60px; height:60px; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 4px 15px rgba(37,211,102,.3); z-index:999; font-size:24px; transition:.3s; }
    .cart-float:hover{ transform:scale(1.1); }
    .cart-count{ position:absolute; top:-5px; right:-5px; background:#ff4444; color:#fff; border-radius:50%; width:20px; height:20px; font-size:10px; display:flex; align-items:center; justify-content:center; font-weight:bold; }
    .loading{text-align:center; padding:50px; font-size:16px; color:#a7b0c3; }
    .no-results{text-align:center; padding:50px; color:#a7b0c3; }
    @media (min-width:600px){ .grid{ column-count:3; } }
    @media (min-width:900px){ .grid{ column-count:4; } }
    @media (max-width:600px){ .controls{ flex-direction:column; align-items:stretch; } }
    .lightbox{ position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.9); display:flex; justify-content:center; align-items:center; z-index:1000; visibility:hidden; opacity:0; transition:opacity .3s, visibility .3s; }
    .lightbox.active{ visibility:visible; opacity:1; }
    .lightbox-content{ position:relative; max-width:90%; max-height:90%; }
    .lightbox img{ max-width:100%; max-height:100%; object-fit:contain; background:transparent; }
    .lightbox-close{ position:absolute; top:-40px; right:0; background:none; border:none; color:#fff; font-size:30px; cursor:pointer; z-index:1001; }
    .lightbox-info{ position:absolute; bottom:-80px; left:0; right:0; background:rgba(20,26,42,.9); padding:15px; border-radius:8px; text-align:center; }
    .modal{ position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.8); display:none; align-items:center; justify-content:center; z-index:1000; }
    .modal.active{ display:flex; }
    .modal-content{ background:var(--card-bg); padding:20px; border-radius:10px; max-width:500px; width:90%; position:relative; }
    .modal-close{ position:absolute; top:10px; right:10px; background:none; border:none; color:var(--text-color); font-size:20px; cursor:pointer; }
    .modal-total{ margin-top:20px; font-weight:bold; }
    .cart-item{ display:flex; gap:10px; margin-bottom:10px; border-bottom:1px solid var(--border-color); padding-bottom:10px; }
    .cart-item img{ width:50px; height:auto; }
  </style>
</head>
<body>
  <header class="header">
    <h1>Otto Repuestos - Cat√°logo</h1>
    <div class="search-container">
      <input id="searchInput" class="search-input" type="search" placeholder="Buscar por c√≥digo o descripci√≥n‚Ä¶" />
      <button id="searchClear" class="search-clear" aria-label="Limpiar">‚úï</button>
    </div>
    <div class="controls">
      <div id="categoryFilters" class="filter-buttons" aria-label="Categor√≠as"></div>
      <div class="stats"><span id="itemCount">0</span> √≠tems</div>
    </div>
  </header>  <div id="loading" class="loading">Cargando datos‚Ä¶</div>
  <div id="noResults" class="no-results" style="display:none;">Sin resultados</div>
  <main id="grid" class="grid" style="display:none;"></main>  <!-- Lightbox -->  <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="Vista de imagen">
    <div class="lightbox-content">
      <button class="lightbox-close" aria-label="Cerrar">√ó</button>
      <img src="" alt="" />
      <div class="lightbox-info">
        <div class="codigo"></div>
        <div class="desc"></div>
        <div class="precio"></div>
      </div>
    </div>
  </div>  <!-- Cart floating button --><button id="cartFloat" class="cart-float" title="Ver carrito">üõí<span id="cartCount" class="cart-count" style="display:none;">0</span></button>

  <!-- Cart Modal -->  <div id="cartModal" class="modal" role="dialog" aria-modal="true" aria-label="Carrito">
    <div class="modal-content">
      <button class="modal-close" aria-label="Cerrar" onclick="document.getElementById('cartModal').classList.remove('active')">‚úï</button>
      <h3>Carrito</h3>
      <div id="cartItems"></div>
      <div id="cartTotal" class="modal-total">Total: 0 Gs</div>
      <button id="sendCart" class="btn btn-whatsapp" style="width:100%; margin-top:10px;">Enviar a WhatsApp</button>
    </div>
  </div>  <!-- Bot√≥n flotante al Validador --><a href="validador.html"
style="position:fixed;bottom:20px;left:20px;background:#0066cc;color:white;padding:10px 16px;border-radius:8px;font-family:sans-serif;text-decoration:none;box-shadow:0 2px 6px rgba(0,0,0,0.3);"> Validador </a>

  <script>
    /* ====== CONFIG ====== */
    const WHATSAPP_NUMBER = '595986803963'; // tu n√∫mero
    const DATA_JSON_URL = 'data.json?v=5';
    const IMG_BASE = './';
    // Categor√≠as fijas para practicar
    const CATEGORIES = ['Mec√°nica', 'Accesorios', 'Paragolpes', 'El√©ctrica y Electr√≥nica'];
    // CATEGOR√çA POR DEFECTO
    const DEFAULT_CATEGORY = 'Mec√°nica'; // <--- CAMBIA ESTO PARA SELECCIONAR OTRA CATEGOR√çA POR DEFECTO

    /* ====== ELEMENTOS ====== */
    const elements = {
      grid: document.getElementById("grid"),
      categoryFilters: document.getElementById("categoryFilters"),
      lightbox: document.getElementById("lightbox"),
      lightboxImage: null, // se asigna luego
      lightboxInfo: null,  // se asigna luego
      searchInput: document.getElementById("searchInput"),
      searchClear: document.getElementById("searchClear"),
      itemCount: document.getElementById("itemCount"),
      loading: document.getElementById("loading"),
      noResults: document.getElementById("noResults"),
      cartFloat: document.getElementById("cartFloat"),
      cartCount: document.getElementById("cartCount"),
      cartModal: document.getElementById("cartModal"),
      cartItems: document.getElementById("cartItems"),
      cartTotal: document.getElementById("cartTotal"),
      sendCart: document.getElementById("sendCart")
    };

    /* ====== ESTADO ====== */
    let ITEMS = [];
    let filteredItems = [];
    let cart = JSON.parse(localStorage.getItem('ottocart') || '[]');
    let currentCategory = DEFAULT_CATEGORY, currentQuery = '', currentSort = 'none';

    /* ====== HELPERS ====== */
    const formatPrice = (n) => new Intl.NumberFormat('es-PY').format(n||0) + " Gs";
    const debounce = (f, w) => { let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>f(...a),w); }; };
    function resolveImage(path){ const safe=encodeURI(path||''); const base=new URL(IMG_BASE, document.baseURI); return new URL(safe, base).href; }
    function escapeHTML(s){return String(s||'').replace(/[&<>\'\"]/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;',"'":'&#39;','\"':'&quot;'}[m]));}
    function jsStr(s){return String(s||'').replace(/\\/g,'\\\\').replace(/'/g,"\\'").replace(/\n/g,'\\n');}

    // Inferencia b√°sica cuando falta "categoria"
    function inferCategory(p){
      const text = `${p.descripcion||''} ${p.codigo||''} ${p.imagen||''}`.toLowerCase();
      if (/-paragolpe/.test(text) || /\bparagolpe(s)?\b/.test(text)) return 'Paragolpes';
      if (/electricayelectronica/.test(text) || /\bel[e√©]ctrica\b|\belectr[o√≥]nica\b/.test(text)) return 'El√©ctrica y Electr√≥nica';
      if (/-mecanica/.test(text) || /\bmec[a√°]nica\b/.test(text) || /\bfiltro\b|\baceite\b|\bhomoc[i√≠]n/.test(text)) return 'Mec√°nica';
      if (/-accesorio/.test(text) || /\baccesorio(s)?\b/.test(text) || /tira barco/.test(text)) return 'Accesorios';
      return 'Accesorios';
    }
    function getCategory(p){ return p.categoria || inferCategory(p); }

    /* ====== CARGA DE DATOS ====== */
    async function loadData() {
      elements.loading.style.display = 'block';
      try {
        const r = await fetch(DATA_JSON_URL, { cache: 'no-store' });
        if (!r.ok) throw new Error('HTTP '+r.status);
        ITEMS = await r.json();
        localStorage.setItem('ottoData', JSON.stringify(ITEMS));
      } catch (e) {
        const cached = localStorage.getItem('ottoData');
        ITEMS = cached ? JSON.parse(cached) : [];
        if (!cached) console.warn('No data.json ni cache:', e.message);
      }
      initializeCatalog();
      renderCategoryFilters();
      buildSortBar();
      verifyAssets();
    }

    function initializeCatalog(){
      elements.loading.style.display = 'none';
      elements.lightboxImage = document.querySelector('#lightbox img');
      elements.lightboxInfo = document.querySelector('.lightbox-info');
      filteredItems = [...ITEMS];
      applyFilters();
      updateCartCount();
      wireSearch();
      wireCartModal();
      wireLightbox();
    }

    /* ====== CABECERA DE CATEGOR√çAS (FIJAS) ====== */
    function renderCategoryFilters() {
      const cats = ['Todos', ...CATEGORIES];
      // Corrige: si currentCategory no existe en cats, lo ponemos
      if (!cats.includes(currentCategory)) currentCategory = 'Todos';
      elements.categoryFilters.innerHTML = cats.map((c)=>
        `<button class="filter-btn ${c===currentCategory?'active':''}" data-cat="${c}" aria-pressed="${c===currentCategory?'true':'false'}">${c}</button>`
      ).join('');
      elements.categoryFilters.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          elements.categoryFilters.querySelectorAll('.filter-btn').forEach(b => { b.classList.remove('active'); b.setAttribute('aria-pressed','false'); });
          btn.classList.add('active'); btn.setAttribute('aria-pressed','true');
          currentCategory = btn.dataset.cat;
          applyFilters();
        });
      });
    }

    /* ====== BARRA DE ORDEN ====== */
    function buildSortBar(){
      const bar = document.createElement('div');
      bar.className='filter-buttons'; bar.id='sortBar'; bar.style.marginTop='6px';
      bar.innerHTML = `
        <button class="filter-btn active" data-sort="none" aria-pressed="true">Sin orden</button>
        <button class="filter-btn" data-sort="price-low" aria-pressed="false">Precio Bajo</button>
        <button class="filter-btn" data-sort="price-high" aria-pressed="false">Precio Alto</button>
        <button class="filter-btn" data-sort="recent" aria-pressed="false">Recientes</button>`;
      elements.categoryFilters.after(bar);
      bar.querySelectorAll('.filter-btn').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          bar.querySelectorAll('.filter-btn').forEach(b=>{b.classList.remove('active');b.setAttribute('aria-pressed','false');});
          btn.classList.add('active'); btn.setAttribute('aria-pressed','true');
          currentSort = btn.dataset.sort;
          applyFilters();
        });
      });
    }

    /* ====== BUSCADOR ====== */
    function wireSearch(){
      elements.searchInput.addEventListener('input', debounce((e)=>{
        currentQuery = String(e.target.value||'').toLowerCase().trim();
        elements.searchClear.style.display = currentQuery ? 'block':'none';
        applyFilters();
      },250));
      elements.searchClear.addEventListener('click', ()=>{
        elements.searchInput.value=''; currentQuery=''; elements.searchClear.style.display='none'; applyFilters();
      });
    }

    /* ====== APLICAR FILTROS ====== */
    function applyFilters(){
      let items = (currentCategory==='Todos') ? [...ITEMS] : ITEMS.filter(p=> getCategory(p) === currentCategory);
      if (currentQuery){
        const q=currentQuery;
        items = items.filter(p =>
          String(p.codigo||'').toLowerCase().includes(q) ||
          String(p.descripcion||'').toLowerCase().includes(q)
        );
      }
      switch(currentSort){
        case 'price-low': items.sort((a,b)=>(a.precio||0)-(b.precio||0)); break;
        case 'price-high': items.sort((a,b)=>(b.precio||0)-(a.precio||0)); break;
        case 'recent': items = items.slice().reverse(); break;
      }
      filteredItems = items;
      renderItems();
    }

    /* ====== RENDER ====== */
    function renderItems(){
      if (!filteredItems.length){
        elements.grid.style.display='none'; elements.noResults.style.display='block'; elements.itemCount.textContent='0'; return;
      }
      elements.grid.style.display='block'; elements.noResults.style.display='none'; elements.itemCount.textContent=filteredItems.length;

      elements.grid.innerHTML = filteredItems.map(p=>`
        <article class="card" data-fullimage="${resolveImage(p.imagen)}" data-codigo="${escapeHTML(p.codigo)}" data-desc="${escapeHTML(p.descripcion)}" data-precio="${p.precio||0}">
          <img src="${resolveImage(p.imagen)}" alt="${escapeHTML(p.descripcion)}" loading="lazy" onerror="this.src='https://via.placeholder.com/300x200/333/fff?text=Sin+Imagen'">
          <div class="info">
            <div class="codigo">${escapeHTML(p.codigo)}</div>
            <div class="desc">${escapeHTML(p.descripcion)}</div>
            <div class="precio">${formatPrice(p.precio||0)}</div>
          </div>
          <div class="card-actions">
            <button class="btn btn-whatsapp" onclick="sendWhatsApp('${jsStr(p.codigo)}','${jsStr(p.descripcion)}',${p.precio||0})">üí¨ WhatsApp</button>
            <button class="btn btn-share" onclick="shareProduct('${jsStr(p.codigo)}','${jsStr(p.descripcion)}')">üì§ Compartir</button>
          </div>
        </article>`).join('');

      document.querySelectorAll('.card').forEach(card=>{
        const img = card.querySelector('img');
        img.addEventListener('click',e=>{e.stopPropagation(); openLightbox(card);});
        card.addEventListener('dblclick',()=>{ addToCart({codigo:card.dataset.codigo, desc:card.dataset.desc, precio:parseInt(card.dataset.precio,10), imagen:card.dataset.fullimage}); toastAdded(card); });
      });
    }

    /* ====== LIGHTBOX ====== */
    function wireLightbox(){
      elements.lightbox.addEventListener('click',e=>{ if(e.target===elements.lightbox || e.target.classList.contains('lightbox-close')) closeLightbox(); });
      window.addEventListener('keydown',e=>{ if(e.key==='Escape') closeLightbox(); });
    }
    function openLightbox(card){
      const url=card.dataset.fullimage, cod=card.dataset.codigo, desc=card.dataset.desc, pr=card.dataset.precio;
      elements.lightboxImage.src=url; elements.lightboxImage.alt=`Imagen ampliada de ${desc}`;
      elements.lightboxInfo.querySelector('.codigo').textContent=cod;
      elements.lightboxInfo.querySelector('.desc').textContent=desc;
      elements.lightboxInfo.querySelector('.precio').textContent=formatPrice(parseInt(pr||'0',10));
      elements.lightbox.classList.add('active');
    }
    function closeLightbox(){ elements.lightbox.classList.remove('active'); }

    /* ====== WHATSAPP / SHARE ====== */
    function sendWhatsApp(codigo, descripcion, precio){
      const msg=`¬°Hola! Me interesa este repuesto:\n\nüìã C√≥digo: ${codigo}\nüìù Descripci√≥n: ${descripcion}\nüí∞ Precio: ${formatPrice(precio||0)}\n\n¬øEst√° disponible?`;
      window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`,'_blank');
    }
    function shareProduct(codigo, descripcion){
      if (navigator.share){ navigator.share({title:`Otto Repuestos - ${codigo}`, text:descripcion, url:window.location.href}); }
      else { navigator.clipboard.writeText(`${codigo} - ${descripcion}\n${window.location.href}`).then(()=>alert('Informaci√≥n copiada al portapapeles')); }
    }
    window.sendWhatsApp=sendWhatsApp; window.shareProduct=shareProduct;

    
    /* ====== CARRITO (simplificado) ====== */
    function showCartModal(){ elements.cartModal.classList.add('active'); }
    function hideCartModal(){ elements.cartModal.classList.remove('active'); }
    function sendCartToWhatsApp(){
      if (!cart.length) return;
      const lines = cart.map((it,i)=>`${i+1}. ${it.codigo} - ${it.desc} - ${formatPrice(it.precio)}`).join('\n');
      const total = cart.reduce((s,it)=>s+(it.precio||0),0);
      const msg = `Carrito Otto Repuestos:\n\n${lines}\n\nTotal: ${formatPrice(total)}`;
      window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`,'_blank');
    }
    function addToCart(item){ cart.push(item); localStorage.setItem('ottocart', JSON.stringify(cart)); updateCartCount(); renderCart(); }
    function removeFromCart(idx){ cart.splice(idx,1); localStorage.setItem('ottocart', JSON.stringify(cart)); updateCartCount(); renderCart(); }
    function updateCartCount(){ elements.cartCount.textContent = cart.length; elements.cartCount.style.display = cart.length ? 'flex' : 'none'; }
    function renderCart(){
      if (!cart.length){ elements.cartItems.innerHTML = '<p>Tu carrito est√° vac√≠o.</p>'; elements.cartTotal.textContent='Total: 0 Gs'; return; }
      elements.cartItems.innerHTML = cart.map((it,idx)=>`
        <div class="cart-item">
          <img src="${it.imagen}" alt="${escapeHTML(it.desc)}" />
          <div style="flex:1;">
            <div style="font-weight:700;">${escapeHTML(it.codigo)}</div>
            <div style="color:#a7b0c3; font-size:12px;">${escapeHTML(it.desc)}</div>
            <div>${formatPrice(it.precio)}</div>
          </div>
          <button class="btn" onclick="removeFromCart(${idx})">Quitar</button>
        </div>`).join('');
      const total = cart.reduce((s,it)=>s+(it.precio||0),0);
      elements.cartTotal.textContent = 'Total: ' + formatPrice(total);
    }
    function toastAdded(card){
      card.style.outline = '2px solid ' + getComputedStyle(document.documentElement).getPropertyValue('--accent-color');
      setTimeout(()=>{ card.style.outline='none'; }, 600);
    }
    function wireCartModal(){
      elements.cartFloat.addEventListener('click', ()=>{ renderCart(); showCartModal(); });
      elements.sendCart.addEventListener('click', sendCartToWhatsApp);
      elements.cartModal.addEventListener('click', (e)=>{ if(e.target===elements.cartModal) hideCartModal(); });
    }

    /* ====== VERIFICADOR ====== */
    async function verifyAssets(){
      if (!ITEMS.length) return;
      const results = await Promise.all(ITEMS.map(i=>new Promise(res=>{
        const img=new Image(); img.onload=()=>res(true); img.onerror=()=>res(false); img.src=resolveImage(i.imagen);
      })));
      const bad = results.filter(ok=>!ok).length;
      if (bad){
        elements.noResults.style.display='block';
        elements.noResults.textContent=`Atenci√≥n: ${bad} imagen(es) no se encontraron (ver consola).`;
        setTimeout(()=>{ elements.noResults.style.display='none'; }, 4000);
      }
    }

    /* ====== INICIO ====== */
    loadData();
  </script>
</body>
</html>